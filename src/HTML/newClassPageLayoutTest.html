<!DOCTYPE html>
<html lang="en">
 
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Courserr</title>

  <!-- Favicon -->

  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap">
  <!-- Material Symbols (for md-icon) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp" />

  <!-- Material Web (md-icon, chips, etc.) -->
  <script type="importmap">
  {
    "imports": {
      "@material/web/": "https://esm.run/@material/web/",
      "@huggingface/transformers": "https://esm.run/@huggingface/transformers"
    }
  }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>

  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

  <!-- Your JS files -->
  <script src="../Javascript/Class.js"></script>
  <script src="../Javascript/ClassInstantiation.js"></script>
  <script src="../Javascript/script.js"></script>
  <script src="../Javascript/loadClass.js"></script>


  <!-- Your CSS -->
  <link rel="stylesheet" href="../Style/style.css">
  <link rel="stylesheet" href="../Style/classPage2.css">
  <link rel="stylesheet" href="../Style/classColours.css">

  <!-- md-icon styling -->
  <style>
    md-icon {
      color: #006A6A;
      --md-icon-size: 48px;
    }
    md-icon.rounded {
      --md-icon-font: 'Material Symbols Rounded';
    }
    md-icon.sharp {
      --md-icon-font: 'Material Symbols Sharp';
    }
    md-icon.outlined {
      --md-icon-font: 'Material Symbols Outlined';
    }
    md-icon[filled] {
      font-variation-settings: 'FILL' 1;
    }
  </style>
</head>

<body class="classPage" style="background-color: var(--light-bg)" id="body">
    <div class="container" id="fullHeightDiv">
        <img src="../Images/menuIcon.png" class="menuMobile openMenu" id="lines" onclick="openClose(true)">
        <img src="../Images/closeIcon.png" class="menuMobile closeMenu" id="exes" onclick="openClose(false)">
        <span class="material-symbols-rounded mode" style="font-size:5vh" onclick="modeChange()">light_mode</span>
        <div class="sidebar" id="sidebar" style="background-color: var(--light-mode-bg)">
          <div class="sidebarItem mobileClose" onclick="openClose(false)" id="mobileClose" style="padding-left: calc(6vh + 1vw + 0.5vw)">
            <span class="material-symbols-rounded sidebar-icon" style="font-size:4vw" onclick="window.location.href = './index.html'";>back</span>
          </div>
          <div class="sidebarItem">
            <span class="material-symbols-rounded sidebar-icon" style="font-size:4vw" onclick="window.location.href = './index.html'";>flood</span>Home
          </div>
          <div class="sidebarItem">
            <span class="material-symbols-rounded sidebar-icon" style="font-size:4vw" onclick="window.open('../handbook.pdf')">menu_book</span>Handbook
          </div>
          <div class="sidebarItem" onclick="window.open('https://ameshighathletics.org/activities/?per_page=12&page=1', '_blank').focus();">
            <span class="material-symbols-rounded sidebar-icon" style="font-size:4vw">groups</span>Clubs & Activities
          </div>
          
          
        </div>
        <div class="main-content">
          <div class="header" style="background-color: var(--light-mode-bg);height: 10vh;" id="header">
                <div class="title"> 
                  <strong>Course<i>rr</i></strong>
                  <!--<button style="height: 10vh; width: 10vw">Click Me</button>-->
                </div>
        </div>
        
        
        
        </div>


        <div class="main-content-class-page">
        <div class="class-info-container" style="padding-top:12.5vh">
            <div class="class-page-header">
                <div class="class-page-header-left">
                    <div class="class-title-teacher-holder">

                        <h1 class="class-title" id="className">Loading...</h1>
                        <hr class="title-teacher-break">
                        <div class="class-teacher" id="teachers">Loading...</div>

                    </div>
                </div>
                <div class="class-page-header-right">

                    <div class="class-prerequisites" id="prereq">

                        <div class="elevated-rectangle-title">Prerequisites</div>
                    </div>

                    <div class="class-tags">
                      <div class="elevated-rectangle-title">Tags</div>
                        <div class="class-tags-holder">
                          <div class="elevated-rectangle-half">Reading Heavy</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                        </div>
                    </div>

                    <div class="class-quick-info" id="quickHits">

                        <div class="elevated-rectangle-title">Quick Hits</div>

                    </div>

                </div>
            </div>

            <div class="class-page-half-box description classPageClassDecription" id="getColor">
              <p class="description-paragraph">Loading...</p>
            </div>

            <div class="class-page-half-box">
              <canvas id="myChart" class='classPageGraphHalf'></canvas>
            </div>

            <!-- AI Summary Box -->
            <div class="ai-summary-container">
              <div class="ai-summary-box">
                <div class="ai-summary-header">
                  <div class="ai-summary-title-section">
                    <span class="material-symbols-rounded ai-icon">psychology</span>
                    <h2 class="ai-summary-title">AI Summary</h2>
                    <div class="ai-mode-indicator" id="aiModeIndicator">
                      <span class="material-symbols-rounded mode-icon">cloud_off</span>
                      <span class="mode-text">Offline Mode</span>
                    </div>
                  </div>
                  <md-filled-button class="generate-summary-btn" id="generateSummaryBtn">
                    <span slot="icon" class="material-symbols-rounded">auto_awesome</span>
                    Generate Summary
                  </md-filled-button>
                </div>
                <div class="ai-summary-content" id="aiSummaryContent">
                  <div class="ai-summary-placeholder">
                    <span class="material-symbols-rounded placeholder-icon">psychology</span>
                    <p>Click "Generate Summary" to get an AI-powered analysis of this course based on student feedback, tags, and course information.</p>
                  </div>
                </div>
                <div class="ai-summary-loading" id="aiSummaryLoading" style="display: none;">
                  <div class="loading-spinner"></div>
                  <p>Generating AI summary...</p>
                </div>
              </div>
            </div>
        </div>





            <div class="class-comment-container" id="commentContainer">

              <div class="comment-header" id="commentHeader">
                <h1>Comments</h1>
              </div>
              <div class="area-with-the-comments">
              <div class="comment-box">
                <div class="comment-text"> 
                  <p>I really enjoyed this class because the material was interesting and our teacher, Ms. Johnson, made it engaging and fun to learn about. The workload can be pretty heavy at times, but I think it's worth it if you're interested in history like I am. My only suggestion would be to maybe have a few more group projects or discussions throughout the semester - sometimes we just sat through lectures for hours without much interaction. Overall though, I learned so much and appreciated the effort Ms. Johnson put into making this class enjoyable.</p>
                </div>
                <div class="review-info">
                  <div class="elevated-rectangle">Average Grade: A+</div>
                  <div class="elevated-rectangle">Time Spent: 2 hours / week</div>
                  <div class="elevated-rectangle">Difficulty: 3 / 5</div>
                </div>
                <!-- <div class="comment-tags-holder">
                  <div class="elevated-rectangle-half">Reading Heavy</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                </div> -->
                <div class="comment-kicker">
                  <!-- <md-icon-button>
                    <span class="material-symbols-rounded" id="likeBtn">thumb_up</span>
                  </md-icon-button>
                  <md-icon-button>
                    <span class="material-symbols-rounded" id="flagBtn">flag</span>
                  </md-icon-button> -->
                  <md-icon-button class="infoBtn">
                    <span class="material-symbols-rounded">info</span>
                  </md-icon-button>

                  

                </div>
              </div>

              <div class="comment-box">
                <div class="comment-text"> 
                  <p>I really enjoyed this class because the material was interesting and our teacher, Ms. Johnson, made it engaging and fun to learn about. The workload can be pretty heavy at times, but I think it's worth it if you're interested in history like I am. My only suggestion would be to maybe have a few more group projects or discussions throughout the semester - sometimes we just sat through lectures for hours without much interaction. Overall though, I learned so much and appreciated the effort Ms. Johnson put into making this class enjoyable.</p>
                </div>
                <div class="review-info">
                  <div class="elevated-rectangle">Average Grade: A+</div>
                  <div class="elevated-rectangle">Time Spent: 2 hours / week</div>
                  <div class="elevated-rectangle">Difficulty: 3 / 5</div>
                </div>
                <!-- <div class="comment-tags-holder">
                  <div class="elevated-rectangle-half">Reading Heavy</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                </div> -->
                <div class="comment-kicker">
                  <!-- <md-icon-button>
                    <span class="material-symbols-rounded" id="likeBtn">thumb_up</span>
                  </md-icon-button>
                  <md-icon-button>
                    <span class="material-symbols-rounded" id="flagBtn">flag</span>
                  </md-icon-button> -->
                  <md-icon-button class="infoBtn">
                    <span class="material-symbols-rounded">info</span>
                  </md-icon-button>

                  

                </div>
              </div>

              <div class="comment-box">
                <div class="comment-text"> 
                  <p>I really enjoyed this class because the material was interesting and our teacher, Ms. Johnson, made it engaging and fun to learn about. The workload can be pretty heavy at times, but I think it's worth it if you're interested in history like I am. My only suggestion would be to maybe have a few more group projects or discussions throughout the semester - sometimes we just sat through lectures for hours without much interaction. Overall though, I learned so much and appreciated the effort Ms. Johnson put into making this class enjoyable.</p>
                </div>
                <div class="review-info">
                  <div class="elevated-rectangle">Average Grade: A+</div>
                  <div class="elevated-rectangle">Time Spent: 2 hours / week</div>
                  <div class="elevated-rectangle">Difficulty: 3 / 5</div>
                </div>
                <!-- <div class="comment-tags-holder">
                  <div class="elevated-rectangle-half">Reading Heavy</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                          <div class="elevated-rectangle-half">Extra Credit</div>
                          <div class="elevated-rectangle-half">Hard Tests</div>
                          <div class="elevated-rectangle-half">Fun</div>
                          <div class="elevated-rectangle-half">Engaging</div>
                </div> -->
                <div class="comment-kicker">
                  <!-- <md-icon-button>
                    <span class="material-symbols-rounded" id="likeBtn">thumb_up</span>
                  </md-icon-button>
                  <md-icon-button>
                    <span class="material-symbols-rounded" id="flagBtn">flag</span>
                  </md-icon-button> -->
                  <md-icon-button class="infoBtn">
                    <span class="material-symbols-rounded">info</span>
                  </md-icon-button>

                  

                </div>
              </div>
              </div>

            </div>
            </div>

       


        
</div>

<div class="dialoge-holder">
  <md-dialog id="infoDialog">
                    <div slot="content">These comments are submitted by students at Ames High School. They are anonymous and reviewed to ensure compliance with Ames Community School District policy. Their purpose is to give students a clear idea of what to expect in a class and to provide insights beyond a standard course description.</div>
                    <div slot="actions">
                      <md-text-button form="form-id" value="ok" id="closeBtn">Ok</md-text-button>
                    </div>
                  </md-dialog>
</div>
<script src="../Javascript/comments.js"></script>
<script src="../Javascript/loadClass.js"></script>

<script>
let course;
  window.onload = function() {
        console.log('JavaScript is running!');
        // Your onload logic
        const params = new URLSearchParams(window.location.search);
        let courseName = params.get('course');
        
        // If course parameter doesn't exist, try category parameter (for backward compatibility)
        if (!courseName) {
          courseName = params.get('category');
          if (courseName) {
            // Convert underscores back to spaces for category parameter
            courseName = courseName.replace(/_/g, ' ');
          }
        }
        
        console.log('Course name from URL: ' + courseName);
        console.log('displayCourseDetails function exists: ' + (typeof displayCourseDetails));
       console.log('courseMap exists: ' + (typeof courseMap !== 'undefined'));
        
        console.log('Course name from URL:', courseName);
        console.log('displayCourseDetails function exists:', typeof displayCourseDetails);
       console.log('courseMap exists:', typeof courseMap !== 'undefined');
        
        if (courseName) {
          if (typeof displayCourseDetails === 'function') {
           console.log('Calling displayCourseDetails...');
            displayCourseDetails();
          } else {
           console.error('displayCourseDetails function not found');
          }
            console.log('Course: ' + courseName);
        } else {
           console.error('No course found in URL');
            console.log('No course found');
        }
        makeCommentBackground();
    };

    function modeChange(thing) {
        console.log("darkmode");
        document.getElementsByTagName('style')[0].innerHTML="md-filter-chip { background-color: rgba(150, 150, 150, 0.5); --md-sys-color-outline:lightgrey;} .header {color: white;} .sidebar{color: white} .menuPic {filter: invert(100%)} .mode {filter: invert(100%)}";
          document.getElementById('body').style.backgroundColor = "var(--dark-bg)";
          document.getElementById('sidebar').style.backgroundColor = "var(--dark-mode-bg)";
          document.getElementById('header').style.backgroundColor = "var(--dark-mode-bg)";
      }

      function openClose(closed) {
  let lines = document.getElementById('lines');
  let exes = document.getElementById('exes');
  let text = document.getElementById('mobileClose');
  let sidebar = document.getElementById('sidebar');
  if(closed) {
    exes.style.opacity = "1";
    exes.style.transform = "rotate(-90deg)"
    exes.style.zIndex = "1002";
    lines.style.opacity = "0";
    lines.style.transform = "rotate(90deg)";
    lines.style.zIndex = "1001";
    sidebar.style.transform = "translateX(0vw)"
    text.style.opacity = "1";
    
  } else {
    exes.style.opacity = "0";
    exes.style.transform = "rotate(0deg)"
    exes.style.zIndex = "1001";
    lines.style.opacity = "1";
    lines.style.transform = "rotate(0deg)";
    lines.style.zIndex = "1002";
    sidebar.style.transform = "translateX(-40vw)"
    text.style.opacity = "0";
  }

}
</script>
<script>
  const infoBtn = document.querySelectorAll('.infoBtn');
  const closeBtn = document.getElementById('closeBtn');
  const infoDialog = document.getElementById('infoDialog');

  for (let i = 0; i < infoBtn.length; i++) {
     infoBtn[i].addEventListener("click", () => {
      infoDialog.show();
     });
    }

  closeBtn.addEventListener('click', () => {
    infoDialog.close(); // opens the dialog
  });
</script>

<script>
// AI Summary Generation with TensorFlow.js BART Model
document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generateSummaryBtn');
    const summaryContent = document.getElementById('aiSummaryContent');
    const loadingDiv = document.getElementById('aiSummaryLoading');
    const modeIndicator = document.getElementById('aiModeIndicator');
    
    // TensorFlow.js BART model configuration
    let bartModel = null;
    let modelLoaded = false;
    const MODEL_NAME = 'Xenova/bart-large-cnn'; // BART model for summarization
    
    if (generateBtn) {
        generateBtn.addEventListener('click', generateAISummary);
    }
    
    // Check online/offline status
    function isOnline() {
        return navigator.onLine;
    }
    
    // Load TensorFlow.js BART model
    async function loadBARTModel() {
        if (modelLoaded) return true;
        
        try {
            console.log('Loading TensorFlow.js BART model...');
            const { pipeline } = await import('@huggingface/transformers');
            
            // Load the BART model for summarization
            bartModel = await pipeline('summarization', MODEL_NAME, {
                quantized: true, // Use quantized model for better performance
                progress_callback: (progress) => {
                    console.log('Model loading progress:', Math.round(progress.loaded / progress.total * 100) + '%');
                }
            });
            
            modelLoaded = true;
            console.log('TensorFlow.js BART model loaded successfully');
            return true;
        } catch (error) {
            console.error('Error loading TensorFlow.js BART model:', error);
            return false;
        }
    }
    
    async function generateAISummary() {
        // Show loading state
        summaryContent.style.display = 'none';
        loadingDiv.style.display = 'flex';
        generateBtn.disabled = true;
        
        // Collect data from the page
        const courseData = collectCourseData();
        
        try {
            let summary;
            
            // Try to use TensorFlow.js BART model if online
            if (isOnline() && await loadBARTModel()) {
                console.log('Using TensorFlow.js BART model for AI summary');
                summary = await generateSummaryWithBART(courseData);
            } else {
                console.log('Using offline fallback for AI summary');
                summary = createAISummary(courseData);
            }
            
            displaySummary(summary);
        } catch (error) {
            console.error('Error generating summary:', error);
            // Fallback to offline method
            const summary = createAISummary(courseData);
            displaySummary(summary);
        }
    }
    
    async function generateSummaryWithBART(courseData) {
        const { courseName, teacher, description, tags, comments, reviewInfo } = courseData;
        
        // Create a more structured and balanced input for the BART model
        let textToSummarize = `Course Information: ${courseName} taught by ${teacher}. `;
        
        // Prioritize course description and structured information
        if (description && description.trim()) {
            textToSummarize += `Course Description: ${description}. `;
        }
        
        // Add tags as key characteristics
        if (tags.length > 0) {
            textToSummarize += `Key Course Characteristics: ${tags.join(', ')}. `;
        }
        
        // Add review metrics as structured data
        if (reviewInfo.length > 0) {
            textToSummarize += `Student Performance Data: ${reviewInfo.join(', ')}. `;
        }
        
        // Include comments but with less weight
        if (comments.length > 0) {
            // Limit comment length to prevent overwhelming the model
            const limitedComments = comments.slice(0, 2).join(' ');
            textToSummarize += `Student Feedback: ${limitedComments}. `;
        }
        
        // Add context about what kind of summary we want
        textToSummarize += `Please provide a comprehensive summary of this course including what students can expect, key characteristics, workload, and overall assessment.`;
        
        try {
            // Use TensorFlow.js BART model for summarization with adjusted parameters
            const result = await bartModel(textToSummarize, {
                max_length: 250,
                min_length: 100,
                do_sample: false,
                length_penalty: 1.2, // Encourage longer summaries
                num_beams: 4 // Better quality generation
            });
            
            const bartSummary = result[0]?.summary_text || 'Unable to generate summary';
            
            // Create a more comprehensive summary format
            let enhancedSummary = `ðŸ¤– **AI-Powered Course Analysis (TensorFlow.js BART):**\n\n${bartSummary}\n\n`;
            
            // Add structured course information
            enhancedSummary += `ðŸ“š **Course Overview:**\n`;
            enhancedSummary += `â€¢ **Course:** ${courseName}\n`;
            enhancedSummary += `â€¢ **Instructor:** ${teacher}\n`;
            
            if (tags.length > 0) {
                enhancedSummary += `â€¢ **Key Characteristics:** ${tags.join(', ')}\n`;
            }
            
            if (reviewInfo.length > 0) {
                enhancedSummary += `â€¢ **Student Metrics:** ${reviewInfo.length} reviews available\n`;
            }
            
            return enhancedSummary;
            
        } catch (error) {
            console.error('TensorFlow.js BART model error:', error);
            throw error; // This will trigger the fallback
        }
    }
    
    function collectCourseData() {
        // Collect course information
        const courseName = document.getElementById('className')?.textContent || 'Unknown Course';
        const teacher = document.getElementById('teachers')?.textContent || 'Unknown Teacher';
        const description = document.querySelector('.description-paragraph')?.textContent || '';
        
        // Collect tags
        const tagElements = document.querySelectorAll('.class-tags-holder .elevated-rectangle-half');
        const tags = Array.from(tagElements).map(tag => tag.textContent.trim());
        
        // Collect comments
        const commentElements = document.querySelectorAll('.comment-text p');
        const comments = Array.from(commentElements).map(comment => comment.textContent.trim());
        
        // Collect review info
        const reviewInfo = [];
        const reviewElements = document.querySelectorAll('.review-info .elevated-rectangle');
        reviewElements.forEach(review => {
            reviewInfo.push(review.textContent.trim());
        });
        
        return {
            courseName,
            teacher,
            description,
            tags,
            comments,
            reviewInfo
        };
    }
    
    // Offline fallback function (original implementation)
    function createAISummary(data) {
        // Analyze the collected data to create a comprehensive summary
        const { courseName, teacher, description, tags, comments, reviewInfo } = data;
        
        let summary = `ðŸ”„ **Offline AI Analysis:**\n\n`;
        
        // Start with course description as the foundation
        if (description && description.trim()) {
            summary += `ðŸ“– **Course Description:**\n${description}\n\n`;
        }
        
        // Course overview with more detail
        summary += `ðŸ“š **Course Overview:**\n`;
        summary += `${courseName} is taught by ${teacher}. `;
        
        // Incorporate description into overview if not already shown
        if (!description || !description.trim()) {
            summary += `This course provides students with comprehensive learning opportunities. `;
        }
        
        // Tags analysis with more context
        if (tags.length > 0) {
            summary += `\n\nðŸ·ï¸ **Key Course Characteristics:**\n`;
            summary += `Based on student feedback, this course is characterized as: ${tags.join(', ')}. `;
            
            // Provide context for each tag
            if (tags.includes('Reading Heavy')) {
                summary += `Students should expect significant reading assignments and should develop strong reading comprehension skills. `;
            }
            if (tags.includes('Hard Tests')) {
                summary += `Assessments are challenging and require thorough preparation and understanding of course material. `;
            }
            if (tags.includes('Fun') || tags.includes('Engaging')) {
                summary += `The course content and teaching methods are designed to be engaging and enjoyable for students. `;
            }
            if (tags.includes('Extra Credit')) {
                summary += `Additional opportunities for academic improvement are available through extra credit assignments. `;
            }
        }
        
        // Enhanced comments analysis
        if (comments.length > 0) {
            summary += `\n\nðŸ’¬ **Student Feedback Analysis:**\n`;
            const positiveAspects = [];
            const challenges = [];
            const workloadNotes = [];
            
            comments.forEach(comment => {
                const lowerComment = comment.toLowerCase();
                if (lowerComment.includes('enjoy') || lowerComment.includes('fun') || lowerComment.includes('great') || lowerComment.includes('love')) {
                    positiveAspects.push('Students find the course engaging and enjoyable');
                }
                if (lowerComment.includes('heavy') || lowerComment.includes('difficult') || lowerComment.includes('challenging') || lowerComment.includes('hard')) {
                    challenges.push('Course workload can be demanding');
                }
                if (lowerComment.includes('workload') || lowerComment.includes('time') || lowerComment.includes('hours')) {
                    workloadNotes.push('Students mention workload considerations');
                }
            });
            
            if (positiveAspects.length > 0) {
                summary += `âœ… **Positive Aspects:** ${positiveAspects[0]}\n`;
            }
            if (challenges.length > 0) {
                summary += `âš ï¸ **Challenges:** ${challenges[0]}\n`;
            }
            if (workloadNotes.length > 0) {
                summary += `â° **Workload Considerations:** Students should plan their time accordingly\n`;
            }
        }
        
        // Review metrics with analysis
        if (reviewInfo.length > 0) {
            summary += `\n\nðŸ“Š **Student Performance Data:**\n`;
            reviewInfo.forEach(info => {
                summary += `â€¢ ${info}\n`;
            });
        }
        
        // Comprehensive recommendation based on all data
        summary += `\n\nðŸŽ¯ **Overall Assessment:**\n`;
        
        // Base recommendation on course description and tags
        if (description && description.toLowerCase().includes('advanced') || tags.includes('Hard Tests')) {
            summary += `This course appears to be academically rigorous and suitable for students seeking a challenging learning experience. `;
        } else if (tags.includes('Fun') || tags.includes('Engaging')) {
            summary += `This course offers an engaging learning environment that balances academic rigor with student enjoyment. `;
        } else {
            summary += `This course provides a solid academic foundation with opportunities for student growth and development. `;
        }
        
        // Add specific recommendations based on tags
        if (tags.includes('Reading Heavy')) {
            summary += `Students should develop strong reading habits and time management skills. `;
        }
        if (tags.includes('Hard Tests')) {
            summary += `Regular study and preparation are essential for success in this course. `;
        }
        if (tags.includes('Extra Credit')) {
            summary += `Students have opportunities to improve their grades through additional work. `;
        }
        
        summary += `Overall, this course offers a comprehensive learning experience that combines academic challenge with student support.`;
        
        return summary;
    }
    
    function displaySummary(summary) {
        // Hide loading and show summary
        loadingDiv.style.display = 'none';
        summaryContent.style.display = 'flex';
        
        // Create and display the summary
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'ai-summary-text';
        summaryDiv.innerHTML = summary.replace(/\n/g, '<br>');
        
        summaryContent.innerHTML = '';
        summaryContent.appendChild(summaryDiv);
        
        // Re-enable button
        generateBtn.disabled = false;
        generateBtn.innerHTML = `
            <span slot="icon" class="material-symbols-rounded">refresh</span>
            Regenerate Summary
        `;
    }
    
    // Update mode indicator
    function updateModeIndicator(isOnline, isModelLoaded = false) {
        if (modeIndicator) {
            const icon = modeIndicator.querySelector('.mode-icon');
            const text = modeIndicator.querySelector('.mode-text');
            
            if (isOnline && isModelLoaded) {
                modeIndicator.className = 'ai-mode-indicator online';
                icon.textContent = 'psychology';
                text.textContent = 'AI Model (BART)';
            } else if (isOnline) {
                modeIndicator.className = 'ai-mode-indicator offline';
                icon.textContent = 'cloud_download';
                text.textContent = 'Loading Model...';
            } else {
                modeIndicator.className = 'ai-mode-indicator offline';
                icon.textContent = 'cloud_off';
                text.textContent = 'Offline Mode';
            }
        }
    }
    
    // Initialize mode indicator
    async function initializeModeIndicator() {
        const online = isOnline();
        let modelReady = false;
        
        if (online) {
            // Try to load the model to check if it's available
            modelReady = await loadBARTModel();
        }
        
        updateModeIndicator(online, modelReady);
    }
    
    // Add network status monitoring
    window.addEventListener('online', async function() {
        console.log('Network connection restored');
        const modelReady = await loadBARTModel();
        updateModeIndicator(true, modelReady);
    });
    
    window.addEventListener('offline', function() {
        console.log('Network connection lost - will use offline fallback');
        updateModeIndicator(false, false);
    });
    
    // Initialize on page load
    initializeModeIndicator();
});
</script>
</body>
</html>